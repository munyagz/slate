<h2 id='1-enable-the-secret-store-feature-of-parity'>1. Enable the Secret Store feature of Parity</h2>
<p>Per default, Parity Ethereum client is built without the Secret Store feature. To enable it, you need to build it from the sources and specifically enable the Secret Store.</p>

<ul>
<li>Make sure you have all the <a href="https://github.com/paritytech/parity-ethereum/#build-dependencies">build dependencies</a>.</li>
<li>Run
<code>
$ git clone https://github.com/paritytech/parity
$ cd parity
$ git checkout beta
$ cargo build --features secretstore --release
</code></li>
</ul>

<p>You can then launch the freshly built parity using <code>$ ./target/release/parity [OPTION]</code>.
In the following steps of the tutorial, <code>./target/release/</code> will be omitted for better readability.</p>
<h2 id='2-create-and-configure-the-users-39-nodes'>2. Create and configure the users&#39; nodes</h2>
<p>In this tutorial, all nodes will run on 1 single machine. We will need to handle the networking ports carefully to avoid conflicts.</p>

<p>To keep a better overview, we will use TOML files to handle each node&#39;s configuration.
Create a directory to store all the configuration files at one place.</p>

<p>All the nodes of this tutorial will run the <a href="Private-development-chain">Private development chain</a>.
To make the configuration a little easier, Alice, Bob or Charlie&#39;s node will only run one at a time. They will share the same <code>users.toml</code> configuration file as the nodes will not be up and running simultaneously.
Create the file <code>users.toml</code> with the following content:</p>
<pre class="highlight toml tab-toml"><code><span class="c"># File users.toml</span>
<span class="c"># This configuration file can be used for either Alice, Bob or Charlie</span>

<span class="nn">[parity]</span>
<span class="py">chain</span> <span class="p">=</span> <span class="s">"dev"</span>
<span class="py">base_path</span> <span class="p">=</span> <span class="s">"db.users"</span>

<span class="nn">[rpc]</span>
<span class="py">port</span> <span class="p">=</span> <span class="mi">8545</span> <span class="c">#default http port for RPC</span>
<span class="py">apis</span> <span class="p">=</span> <span class="nn">["secretstore"]</span> <span class="c"># to access dedicated methods</span>

<span class="nn">[secretstore]</span>
<span class="py">disable</span> <span class="p">=</span> <span class="kc">true</span> <span class="c"># users do not run a secret store node</span>

<span class="nn">[network]</span>
<span class="py">port</span> <span class="p">=</span> <span class="mi">30300</span>
</code></pre>
<p>We can now create an account for Alice, Bob, and Charlie using the passwords: <code>alicepwd</code>, <code>bobpwd</code> and <code>charliepwd</code>.</p>

<p>To do this, simply run <code>parity --config users.toml account new</code> using the passwords given above starting with Alice and repeat the operation for Bob and Charlie.
<code>bash
Loading config file from users.toml
Please note that password is NOT RECOVERABLE.
Type password: # type the password given above
Repeat password: # type again 
0xe5a4b6f39b4c3e7203ca8caeecbad58d8f29b046
</code>
It will give you each time the address of the desired user. Make sure to store them.
You now have 3 accounts for your 3 users, we will use these addresses in this tutorial:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Password</th>
<th>Address</th>
</tr>
</thead><tbody>
<tr>
<td>Alice</td>
<td>alicepwd</td>
<td>0xe5a4b6f39b4c3e7203ca8caeecbad58d8f29b046</td>
</tr>
<tr>
<td>Bob</td>
<td>bobpwd</td>
<td>0xfeacd0d28fd158ba2d3adb6d69d20c723214edc9</td>
</tr>
<tr>
<td>Charlie</td>
<td>charliepwd</td>
<td>0xdab0055e3abb40d7281b058bb5e6966c50582951</td>
</tr>
</tbody></table>
<h2 id='3-create-and-configure-the-secret-store-nodes'>3. Create and configure the Secret Store nodes</h2>
<p>As all the Secret Store nodes (ss1, ss2 and ss3) need to run simultaneously, we will have to create 3 different configuration files and make sure the networking ports do not conflict.
The configuration for ss1 will be a little different than the 2 others as this node will be open to receive calls from the users.</p>
<h3 id='3-1-configuration-file-for-the-secret-store-node-1'>3.1 Configuration file for the Secret Store node 1</h3>
<p>Let&#39;s create the file <code>ss1.toml</code> with the following content:
```toml
[parity]
chain = &quot;dev&quot;
base_path = &quot;db.ss1&quot;</p>

<p>[ui]
disable = true</p>

<p>[rpc]
disable = true</p>

<p>[ipc]
disable = true</p>

<p>[dapps]
disable = true</p>

<p>[websockets]
disable = true</p>

<p>[network]
port = 30301
bootnodes = []</p>

<p>[ipfs]
enable = false</p>

<p>[snapshots]
disable_periodic = true</p>

<p>[secretstore]
disable = false
disable_http = false      # This node will expose a Secret Store HTTP API
http_interface = &quot;local&quot;  # The HTTP API is available locally only
http_port = 8010          # The Secret Store HTTP API is available at this port
acl_contract = &quot;none&quot;     # Insecure, will be changed later on
server_set_contract = &quot;none&quot;
nodes = []
interface = &quot;local&quot;
port = 8011               # port used to communicated with other Secret Store nodes
path = &quot;db.ss1/secretstore&quot;
```</p>

<p>This configuration file is not complete yet but it allows us to create an account for our first node.
Run <code>parity --config ss1.toml account new</code> with the password <code>ss1pwd</code> to create an account for our first Secret Store node.
<code>bash
Loading config file from users.toml
Please note that password is NOT RECOVERABLE.
Type password: # type the password given above
Repeat password: # type again 
0x93f22c0fa2e4e0750669add48dd8d9dfb8af36f4
</code></p>

<p>We will need to create a password file also for the account to be autonomously usable by the Secret Store node to sign messages. </p>

<p>Run the following command to create a file named <code>ss1.pwd</code> containing the password <code>ss1pwd</code>:</p>
<pre class="highlight shell"><code> <span class="nb">echo</span> <span class="s2">"ss1pwd"</span> &gt; ss1.pwd
</code></pre>
<p>We will use this address and password file right away in our <code>ss1.toml</code> config file. Add the address (without <code>0x</code>) as <code>self_secret</code> in the <code>[secretstore]</code> part and add an <code>[account]</code> as follow. </p>
<pre class="highlight toml tab-toml"><code><span class="c">#Add to the [secretstore] section</span>
<span class="py">self_secret</span> <span class="p">=</span> <span class="s">"93f22c0fa2e4e0750669add48dd8d9dfb8af36f4"</span> <span class="c"># account address without the "0x"</span>

<span class="c">#Secret store nodes need an unlocked account to sign messages with</span>
<span class="nn">[account]</span>
<span class="py">password</span> <span class="p">=</span> <span class="nn">["ss1.pwd"]</span>
</code></pre>
<p>The configuration file now looks like:
```toml
[parity]
chain = &quot;dev&quot;
base_path = &quot;db.ss1&quot;</p>

<p>[ui]
disable = true</p>

<p>[rpc]
disable = true</p>

<p>[ipc]
disable = true</p>

<p>[dapps]
disable = true</p>

<p>[websockets]
disable = true</p>

<p>[network]
port = 30301
bootnodes = []</p>

<p>[ipfs]
enable = false</p>

<p>[snapshots]
disable_periodic = true</p>

<p>[secretstore]
self_secret = &quot;93f22c0fa2e4e0750669add48dd8d9dfb8af36f4&quot; # account address without the &quot;0x&quot;
disable = false
disable_http = false
http_interface = &quot;local&quot;
http_port = 8010
acl_contract = &quot;none&quot;
server_set_contract = &quot;none&quot;
nodes = []
interface = &quot;local&quot;
port = 8011
path = &quot;db.ss1/secretstore&quot;</p>

<p>[account]
password = [&quot;ss1.pwd&quot;]
```</p>

<p>Starting the node with this configuration file should now be possible with <code>parity --config ss1.toml</code>
<code>bash
Loading config file from ss1.toml
Starting Parity/v1.12.0-unstable-458afcd-20180620/x86_64-linux-gnu/rustc1.26.1
Keys path db.ss1/keys/DevelopmentChain
DB path db.ss1/chains/DevelopmentChain/db/1484bce8c021f2ca
Path to dapps db.ss1/dapps
State DB configuration: fast
Operating mode: active
Configured for DevelopmentChain using InstantSeal engine
Starting SecretStore node: 83a051ff44f25df39cbf97b5ce48b48f7e3ba740f32d07e39df59743ec4a62b3e24cf041bfe5e1e149dc2228798342927444e3bd4b3798572045404880b275b4
Running SecretStore with disabled ACL check: everyone has access to stored keys
Public node URL: enode://59ff7f71a8ced85f23d2455b8645931e962886cce7025fd4fb769c4881c505d8445aa24be98b1aa3067cf7490a2ff0cd1558c37f6a536a4d799f8d93c3fe21ea@127.0.0.1:30301
</code></p>

<p>Note the last 3 lines give interesting information:
- It tells you that our configuration is currently insecure due to <code>acl_contract = &quot;none&quot;</code>. If we keep it like this in the future, Alice, Bob or Charlie could access any key. We will change it later in the tutorial.
- <code>Starting SecretStore node: 0x83a051ff44f...</code> gives you the public key of this node. Copy it as we will use it in the next step.
- <code>Public node URL: enode://59ff7f71a8ce..</code> gives you.. well the public URL of your node! Copy it as we will use it in the next step.</p>
<h3 id='3-2-configuration-file-for-the-secret-store-node-2'>3.2 Configuration file for the Secret Store node 2</h3>
<p>The second and third nodes will have a very similar syntax. They will not expose any HTTP API to the outside.
Let&#39;s create <code>ss2.toml</code> with the following content:
```toml
[parity]
chain = &quot;dev&quot;
base_path = &quot;db.ss2&quot;</p>

<p>[ui]
disable = true</p>

<p>[rpc]
disable = true</p>

<p>[ipc]
disable = true</p>

<p>[dapps]
disable = true</p>

<p>[websockets]
disable = true</p>

<p>[network]
port = 30302
bootnodes = []</p>

<p>[ipfs]
enable = false</p>

<p>[snapshots]
disable_periodic = true</p>

<p>[secretstore]
disable = false
disable_http = true   # Secret Store nodes 2 and 3 are not accessibles from the outside
acl_contract = &quot;none&quot; # no permissionning contract used yet
server_set_contract = &quot;none&quot;
nodes = []
interface = &quot;local&quot;
port = 8012
path = &quot;db.ss2/secretstore&quot;
```</p>

<p>Now create an account for <code>ss2</code> with the password <code>ss2pwd</code> by running <code>parity --config ss2.toml account new</code>:
<code>bash
Loading config file from users.toml
Please note that password is NOT RECOVERABLE.
Type password: # type the password given above
Repeat password: # type again 
0xf0d5f6f68d18e190d010c52269ccf97d06204761
</code>
Copy the given address, this will be the account ss2 will use to sign its messages.
We will need to create a password file also for the account to be autonomously usable by the Secret Store node. </p>

<p>Run the following command to create a file named <code>ss2.pwd</code> containing the password <code>ss2pwd</code>:</p>
<pre class="highlight shell"><code> <span class="nb">echo</span> <span class="s2">"ss2pwd"</span> &gt; ss2.pwd
</code></pre>
<p>We will use this address and password file right away in our <code>ss2.toml</code> config file. Add the address (without <code>0x</code>) as <code>self_secret</code> in the <code>[secretstore]</code> part and add an <code>[account]</code> as follow. </p>
<pre class="highlight toml tab-toml"><code><span class="c">#Add to the [secretstore] section</span>
<span class="py">self_secret</span> <span class="p">=</span> <span class="s">"f0d5f6f68d18e190d010c52269ccf97d06204761"</span> <span class="c"># account address without the "0x"</span>

<span class="c">#Secret store nodes need an unlocked account to sign messages with</span>
<span class="nn">[account]</span>
<span class="py">password</span> <span class="p">=</span> <span class="nn">["ss2.pwd"]</span>
</code></pre>
<p>Launch the node with the updated configuration and copy somewhere the public key given after the message <code>Starting SecretStore node</code> as well as the <code>Public node URL</code>.</p>
<h3 id='3-3-configuration-file-for-the-secret-store-node-3'>3.3 Configuration file for the Secret Store node 3</h3>
<p>Repeat the same actions with <code>ss3.toml</code> with the following content:
```toml
[parity]
chain = &quot;dev&quot;
base_path = &quot;db.ss3&quot;</p>

<p>[ui]
disable = true</p>

<p>[rpc]
disable = true</p>

<p>[ipc]
disable = true</p>

<p>[dapps]
disable = true</p>

<p>[websockets]
disable = true</p>

<p>[network]
port = 30303
bootnodes = []</p>

<p>[ipfs]
enable = false</p>

<p>[snapshots]
disable_periodic = true</p>

<p>[secretstore]
disable = false
disable_http = true   # Secret Store nodes 2 and 3 are not accessibles from the outside
acl_contract = &quot;none&quot; # no permissionning contract used yet
server_set_contract = &quot;none&quot;
nodes = []
interface = &quot;local&quot;
port = 8013
path = &quot;db.ss3/secretstore&quot;
```</p>

<p>Now create an account for <code>ss3</code> with the password <code>ss3pwd</code> by running <code>parity --config ss3.toml account new</code>:
<code>bash
Loading config file from users.toml
Please note that password is NOT RECOVERABLE.
Type password: # type the password given above
Repeat password: # type again 
0x0f7b7d4120246348968530fb36092cd36ebaedbb
</code></p>

<p>We will need to create a password file also for the account to be autonomously usable by the Secret Store node. </p>

<p>Run the following command to create a file named <code>ss3.pwd</code> containing the password <code>ss3pwd</code>:</p>
<pre class="highlight shell"><code> <span class="nb">echo</span> <span class="s2">"ss3pwd"</span> &gt; ss3.pwd
</code></pre>
<p>We will use this address and password file right away in our <code>ss3.toml</code> config file. Add the address (without <code>0x</code>) as <code>self_secret</code> in the <code>[secretstore]</code> part and add an <code>[account]</code> as follow. </p>
<pre class="highlight toml tab-toml"><code><span class="c">#Add to the [secretstore] section</span>
<span class="py">self_secret</span> <span class="p">=</span> <span class="s">"0f7b7d4120246348968530fb36092cd36ebaedbb"</span> <span class="c"># account address without the "0x"</span>

<span class="c">#Secret store nodes need an unlocked account to sign messages with</span>
<span class="nn">[account]</span>
<span class="py">password</span> <span class="p">=</span> <span class="nn">["ss3.pwd"]</span>
</code></pre>
<p>Launch the node with the updated configuration and note the public key given after the message <code>Starting SecretStore node</code> as well as the <code>Public node URL</code></p>
<h3 id='4-add-bootnodes-to-each-configuration-file'>4. Add bootnodes to each configuration file</h3>
<p>We now have copied all the public URLs (enodes) of our Secret Store nodes as well as their public key. You need manually modify the ip at the end of the enode address to use the local host address <code>127.0.0.1</code> instead of your local address. 
<code>bash
| Node  | Public Key                                                                                                                        | Secret Store port     | Enode                                                                                                                                                     |
|------ |---------------------------------------------------------------------------------------------------------------------------------- |-------------------    |---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1     | 83a051ff44f25df39cbf97b5ce48b48f7e3ba740f32d07e39df59743ec4a62b3e24cf041bfe5e1e149dc2228798342927444e3bd4b3798572045404880b275b4  | 8011                  | enode://59ff7f71a8ced85f23d2455b8645931e962886cce7025fd4fb769c4881c505d8445aa24be98b1aa3067cf7490a2ff0cd1558c37f6a536a4d799f8d93c3fe21ea@127.0.0.1:30301  |
| 2     | 32be3581ee307da5ed3c6045b6213317fd5f2ac8525d16051c784a251c801ca47f1bb7180b0c40ca754f705837900a4d2f956b7cec5d0094c6dae397371b8f4a  | 8012                  | enode://800cf3b097974b9740d9d7aeda28bf1655e7c30a10bdb5f616ee0b41b786c13ce8d4008854d96430193b7cb4710a59c418566d5f6111bce4a18319757eaec358@127.0.0.1:30302  |
| 3     | 7b42943621c70020e62163ff24cc57366d820d5280495c8d9088b9a6bafbfef5b7a79bc3a56d324c325b970415692e48b9dd85102bd07fbaa7b05c6093697355  | 8013                  | enode://58815b57d8af2bc04963bde42b27deca674c18dca4098b8891296479ce0a83c2398a141babb835f181c6447bb1ac2ce4dca88ec20908d41b86166018d842fab4@127.0.0.1:30303  |
</code></p>

<p>We now have the enode address of each Secret Store node (with the modified IP <code>127.0.0.1</code>). We will add them in the <code>bootnodes</code> section of all the files (including the users).
The users&#39; configuration file <code>users.toml</code> should contain all of the bootnodes, the network section should now look like this:
<code>toml
[network]
port = 30300
bootnodes = [
  &quot;enode://59ff7f71a8ced85f23d2455b8645931e962886cce7025fd4fb769c4881c505d8445aa24be98b1aa3067cf7490a2ff0cd1558c37f6a536a4d799f8d93c3fe21ea@127.0.0.1:30301&quot;,
  &quot;enode://800cf3b097974b9740d9d7aeda28bf1655e7c30a10bdb5f616ee0b41b786c13ce8d4008854d96430193b7cb4710a59c418566d5f6111bce4a18319757eaec358@127.0.0.1:30302&quot;,
  &quot;enode://58815b57d8af2bc04963bde42b27deca674c18dca4098b8891296479ce0a83c2398a141babb835f181c6447bb1ac2ce4dca88ec20908d41b86166018d842fab4@127.0.0.1:30303&quot;
]
</code></p>

<p>We will add to each Secret Store node&#39;s configuration the URL of the 2 others (as having its own address as bootnode wouldn&#39;t make sense).
The network section of <code>ss1.toml</code> for example will have the enodes of <code>ss2</code> and <code>ss3</code> and look like this:
<code>toml
[network]
port = 30301
bootnodes = [
  &quot;enode://800cf3b097974b9740d9d7aeda28bf1655e7c30a10bdb5f616ee0b41b786c13ce8d4008854d96430193b7cb4710a59c418566d5f6111bce4a18319757eaec358@127.0.0.1:30302&quot;, #node 2
  &quot;enode://58815b57d8af2bc04963bde42b27deca674c18dca4098b8891296479ce0a83c2398a141babb835f181c6447bb1ac2ce4dca88ec20908d41b86166018d842fab4@127.0.0.1:30303&quot; #node 3
]
</code></p>

<p>Finally, we will need to construct the Secret Store node addresses with <code>public_key@127.0.0.1:secret_store_port</code> to define the <code>node</code> value in the <code>[secretstore]</code> section.</p>

<p>It will be the same for each node and will look like this:
<code>toml
nodes = [
  &quot;83a051ff44f25df39cbf97b5ce48b48f7e3ba740f32d07e39df59743ec4a62b3e24cf041bfe5e1e149dc2228798342927444e3bd4b3798572045404880b275b4@127.0.0.1:8011&quot;,
  &quot;32be3581ee307da5ed3c6045b6213317fd5f2ac8525d16051c784a251c801ca47f1bb7180b0c40ca754f705837900a4d2f956b7cec5d0094c6dae397371b8f4a@127.0.0.1:8012&quot;,
  &quot;7b42943621c70020e62163ff24cc57366d820d5280495c8d9088b9a6bafbfef5b7a79bc3a56d324c325b970415692e48b9dd85102bd07fbaa7b05c6093697355@127.0.0.1:8013&quot;
]
</code></p>

<p>Find <a href="https://github.com/Tbaut/Secret-Store-Tutorial-files/tree/master/no-permissioning-contract">here</a> example files that you can compare yours with (the keys and account will obviously change).</p>

<p>You can now launch all the Secret Store nodes with the updated configuration. You might see some errors <code>&#39;Connection refused (os error 111)&#39; when establishing outbound connection with 127.0.0.1:8013</code> when launching node 1 and 2 because not all nodes are online, but once they are all up, you should see logs like this:
<code>bash
$ ~/paritytech/parity-ethereum/target/release/parity --config ss3.toml
Loading config file from ss3.toml
2018-06-29 22:26:46  Starting Parity/v1.12.0-unstable-458afcd-20180620/x86_64-linux-gnu/rustc1.26.1
2018-06-29 22:26:46  Keys path db.ss3/keys/DevelopmentChain
2018-06-29 22:26:46  DB path db.ss3/chains/DevelopmentChain/db/1484bce8c021f2ca
2018-06-29 22:26:46  Path to dapps db.ss3/dapps
2018-06-29 22:26:46  State DB configuration: fast
2018-06-29 22:26:46  Operating mode: active
2018-06-29 22:26:46  Configured for DevelopmentChain using InstantSeal engine
2018-06-29 22:26:46  Starting SecretStore node: 0x7b42943621c70020e62163ff24cc57366d820d5280495c8d9088b9a6bafbfef5b7a79bc3a56d324c325b970415692e48b9dd85102bd07fbaa7b05c6093697355
2018-06-29 22:26:46  Running SecretStore with disabled ACL check: everyone has access to stored keys
2018-06-29 22:26:46  Public node URL: enode://58815b57d8af2bc04963bde42b27deca674c18dca4098b8891296479ce0a83c2398a141babb835f181c6447bb1ac2ce4dca88ec20908d41b86166018d842fab4@127.0.0.1:30303
2018-06-29 22:27:16     2/25 peers   10 KiB chain 31 KiB db 0 bytes queue 10 KiB sync  RPC:  0 conn,    0 req/s,    0 µs
2018-06-29 22:27:46     2/25 peers   10 KiB chain 31 KiB db 0 bytes queue 10 KiB sync  RPC:  0 conn,    0 req/s,    0 µs
2018-06-29 22:28:16     2/25 peers   10 KiB chain 31 KiB db 0 bytes queue 10 KiB sync  RPC:  0 conn,    0 req/s,    0 µs
2018-06-29 22:28:46     2/25 peers   10 KiB chain 31 KiB db 0 bytes queue 10 KiB sync  RPC:  0 conn,    0 req/s,    0 µs
2018-06-29 22:29:16     2/25 peers   10 KiB chain 31 KiB db 0 bytes queue 10 KiB sync  RPC:  0 conn,    0 req/s,    0 µs
2018-06-29 22:29:46     2/25 peers   10 KiB chain 31 KiB db 0 bytes queue 10 KiB sync  RPC:  0 conn,    0 req/s,    0 µs
2018-06-29 22:30:16     2/25 peers   10 KiB chain 31 KiB db 0 bytes queue 10 KiB sync  RPC:  0 conn,    0 req/s,    0 µs
2018-06-29 22:30:46     2/25 peers   10 KiB chain 31 KiB db 0 bytes queue 10 KiB sync  RPC:  0 conn,    0 req/s,    0 µs
2018-06-29 22:31:16     2/25 peers   10 KiB chain 31 KiB db 0 bytes queue 10 KiB sync  RPC:  0 conn,    0 req/s,    0 µs
2018-06-29 22:31:46     2/25 peers   10 KiB chain 31 KiB db 0 bytes queue 10 KiB sync  RPC:  0 conn,    0 req/s,    0 µs
</code></p>

<p>Most interestingly, <code>2/25 peers</code> means that this node is connected with the 2 others on the blockchain.</p>
<h2 id='5-network-overview'>5. Network overview</h2>
<p>Here is an overview of the ports used by each node of the system configured in this section. Note that each user has the same ports as they will use the same node (not at the same time though). The RPC HTTP API port (8545) gives access to the Parity client&#39;s internal RPC API methods. SS1 exposes an HTTP API the users will use later on.
<img src="/images/ss-overview-1.jpg" alt="system port overview" /></p>

<p>|<a href="Secret-Store-Tutorial-overview.md"> ← Tutorial overview</a> | <a href="Secret-Store-Tutorial-2.md">Part 2 - Document encryption → </a>|</p>
